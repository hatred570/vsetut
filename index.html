<script>
document.addEventListener('DOMContentLoaded', () => {
    // üõë –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –Ω–µ –≤ Telegram
    if (!window.Telegram || !Telegram.WebApp) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –≤ Telegram
        document.body.innerHTML = `
            <div style="color:#777;font-family:sans-serif;text-align:center">
                –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω—É—Ç—Ä–∏ Telegram
            </div>
        `;
        return;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    const VALID_KEY = 'bozz1';
    const BOT_LINK = 'https://t.me/diavozbuczulolzodbot';
    const REDIRECT_FLAG = 'redirect_done';

    const loading = document.getElementById('loading');
    const message = document.getElementById('message');

    const startParam = Telegram.WebApp.initDataUnsafe?.start_param;

    // –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
    if (sessionStorage.getItem(REDIRECT_FLAG)) {
        loading.style.display = 'none';
        message.style.display = 'block';
        message.innerText = '–ì–æ—Ç–æ–≤–æ';
        return;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–ª—é—á
    if (startParam === VALID_KEY) {
        sessionStorage.setItem(REDIRECT_FLAG, '1');

        // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        loading.style.display = 'none';
        message.style.display = 'block';
        message.innerText = '–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...';

        // –ü—Ä–æ–±—É–µ–º –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ Telegram
        try {
            Telegram.WebApp.openTelegramLink(BOT_LINK);

            // –ü–µ—Ä–µ—Ö–æ–¥ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã —É—á–µ—Å—Ç—å –≤—Ä–µ–º—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
            setTimeout(() => {
                window.location.href = BOT_LINK;
            }, 300);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Telegram —Å—Å—ã–ª–∫–∏:', error);
            message.innerText = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
        }
    } else {
        loading.style.display = 'none';
        message.style.display = 'block';
        message.innerText = '–í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
    }
});
</script>
